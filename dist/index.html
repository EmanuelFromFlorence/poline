<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8" />
  <!-- Primary Meta Tags -->
  <title>Poline</title>
  <meta name="title" content="poline — Color ramp generator using curves within the HSV color model">
  <meta name="description"
    content="poline is lightweight, dependency free and fast JavaScript function written in TypeScript. It generates color ramps based on a curve within the HSV color model. This page serves as preview for the variety of options the function takes.">
  <meta name="keywords" content="color, colour, generative, generative-art, generative-design, palette, colorpalette">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://meodai.github.io/poline/">
  <meta property="og:title" content="poline — Color ramp generator using curves within the HSV color model">
  <meta property="og:description"
    content="poline is lightweight, dependency free and fast JavaScript function written in TypeScript. It generates color ramps based on a curve within the HSV color model. This page serves as preview for the variety of options the function takes.">
  <meta property="og:image" content="https://meodai.github.io/poline/socialfb.png">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://meodai.github.io/poline/">
  <meta property="twitter:title" content="poline — Color ramp generator using curves within the HSV color model">
  <meta property="twitter:description"
    content="poline is lightweight, dependency free and fast JavaScript function written in TypeScript. It generates color ramps based on a curve within the HSV color model. This page serves as preview for the variety of options the function takes.poline is lightweight, dependency free and fast JavaScript function written in TypeScript. It generates color ramps based on a curve within the HSV color model. This page serves as preview for the variety of options the function takes.">
  <meta property="twitter:image" content="https://meodai.github.io/poline/socialfb.png">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Aboreto&display=swap" rel="stylesheet">

  <style>
    :root {
      font-family: "Inter", sans-serif;
      background: #fff;
      color: #202124;

      font-family: 'Aboreto', cursive;
    }

    h1 {
      position: absolute;
      top: 0;
      left: 50%;
      font-size: 5rem;
      text-align: center;
      margin: 0;
      padding: 0;
      font-weight: normal;
      transform: translate(-50%, 0);
      letter-spacing: -0.05em;
    }

    body::after {
      position: absolute;
      content: "";
      bottom: 0;
      left: 0;
      right: 0;
      height: 5vmin;
      background: linear-gradient(90deg, var(--prev));
    }

    body::before {
      position: absolute;
      content: "";
      width: 10vmin;
      height: 10vmin;
      right: 1rem;
      bottom: 7vmin;
      background: conic-gradient(var(--prev));
      border-radius: 50%;
    }

    .picker {
      position: relative;
      width: 60vmin;
      aspect-ratio: 1;
      background: radial-gradient(closest-side, #000, rgba(255, 255, 255, 0), #fff), conic-gradient(from 90deg, var(--grad));
      --s: 1;
      --l: .5;
      margin: 12rem auto 0;
    }

    svg {
      position: relative;
      z-index: 2;
      overflow: visible !important;
    }

    svg line.wheel__line {
      stroke: #202124;
      stroke-width: 0.25;
      stroke-dasharray: 0.5 0.5;
    }

    svg circle {
      stroke: #000;
      stroke-width: 0.25;
    }

    svg line.wheel__satline {
      stroke-dasharray: 0 0;
      stroke-width: 1;
      stroke-linecap: round;
    }

    svg line.wheel__satline--bg {
      stroke: #fff;
      stroke-width: 1.5;
      stroke-dasharray: 0 0;
    }

    .wheel__huelabel {
      -webkit-user-select: none;
        -moz-user-select: none;
          -ms-user-select: none;
              user-select: none;
      pointer-events: none;
      font-weight: normal;
      box-sizing: border-box;
      position: absolute;
      top: 50%;
      left: 50%;
      width: calc(100% + 18vmin);
      transform: translate(-50%, -50%) rotate(calc(var(--i, 0) * 360deg));
      font-size: 2vmin;
      padding: 0.2em 1em 0.2em 94%;
      z-index: 1;
      text-align: right;
      pointer-events: none;
    }

    .wheel__huelabel::before,
    .wheel__huelabel::after {
      content: "";
      position: absolute;
      bottom: 50%;
      left: 91%;
      right: 6vmin;
      height: 1px;
      background: #202124;
      transform: translateY(50%);
    }

    .wheel__huelabel::after {
      height: 30%;
      aspect-ratio: 1;
      right: auto;
      left: 90%;
      background: hsl(calc(360 * var(--i, 0)), 100%, 70%);
      border-radius: 50%;
      border: 1px solid #fff;
      transform: translate(-50%, 50%);
    }
  </style>
</head>

<body>
  <h1>Poline</h1>

  <div data-picker class="picker"></div>

  <script type="module">
    console.clear();

    import {
      Poline,
      positionFunctions,
      randomHSLPair,
    } from "./index.mjs";

    const scale = 100;
    const namespaceURI = 'http://www.w3.org/2000/svg';

    const stepsToLabels = (steps = 360 / 10) => new Array(steps)
        .fill('')
        .map((_, i) => `
          <strong class="wheel__huelabel" style="--i: ${i / steps}">${i * 10}</strong>`)
        .join('')

    const createCSSRainbowGradient = (steps = 360 / 10) => new Array(steps)
        .fill('')
        .map((_, i) => `hsl(${i / (steps - 1) * 360}, calc(var(--s) * 60%), calc(var(--l,0) * 100%))`)
        .join(',');

    const createSVG = (scale = 100) => {
      const $svg = document.createElementNS(
        namespaceURI, 'svg'
      );
      $svg.setAttribute('viewBox', `0 0 ${scale} ${scale}`);
      return $svg;
    }

    const colorArrToSteppedGradient = (colorsArr) => colorsArr.map(
      (c, i) => `${c} ${i / colorsArr.length * 100}% ${(i + 1) / colorsArr.length * 100}%`
    ).join();

    let poline = new Poline(
      randomHSLPair(),
      3,
      positionFunctions.sinusoidalPosition,
      positionFunctions.quadraticPosition,
      positionFunctions.linearPosition,
    );

    const $picker = document.querySelector('[data-picker]');
    const hueSteps = 360 / 10;
    
    const $svg = createSVG(scale);
    $picker.innerHTML = stepsToLabels(hueSteps);
    $picker.appendChild($svg);
    

    $picker.style.setProperty('--grad', createCSSRainbowGradient(hueSteps));
    

    const hue = Math.random() * 360;

    poline.addAnchorPoint({color: [hue, Math.random(), .6 + Math.random() * .3]});    
    poline.addAnchorPoint({color: poline.anchorPoints[0].color});
    console.log(poline);

    function updateSVG () {
      $svg.innerHTML = '';

      poline.anchorPoints.forEach(anchor => {
        const $circle = document.createElementNS(namespaceURI, 'circle');
        $circle.setAttribute('cx', anchor.x * scale);
        $circle.setAttribute('cy', anchor.y * scale);
        $circle.setAttribute('r', 2)
        //anchor.hslCSS
        $circle.setAttribute('fill', '#fff');
        $svg.appendChild($circle);
      });

      poline.flattenedPoints.forEach((point, i) => {
        const $line = document.createElementNS(namespaceURI, 'line');
        $line.classList.add('wheel__line');
        $line.setAttribute('x1', point.x * scale);
        $line.setAttribute('y1', point.y * scale);
        const nextI = (i + 1) % poline.flattenedPoints.length;
        $line.setAttribute('x2', poline.flattenedPoints[nextI].x * scale);
        $line.setAttribute('y2', poline.flattenedPoints[nextI].y * scale);
        if (i !== poline.flattenedPoints.length - 1) {
          $svg.appendChild($line);
        }

        const $circle = document.createElementNS(namespaceURI, 'circle');
        $circle.setAttribute('cx', point.x * scale);
        $circle.setAttribute('cy', point.y * scale);
        $circle.setAttribute('r', 1)
        $circle.setAttribute('fill', point.hslCSS);
        $svg.appendChild($circle);

        /*
        // create a vertical line with a height representing the saturation
        const $vline = document.createElementNS(namespaceURI, 'line');
        const $vlineBG = document.createElementNS(namespaceURI, 'line');
        $vlineBG.setAttribute('x1', point.x * scale);
        $vline.setAttribute('x1', point.x * scale);

        $vline.setAttribute('y1', point.y * scale);
        $vlineBG.setAttribute('y1', point.y * scale);

        $vline.setAttribute('x2', point.x * scale);
        $vlineBG.setAttribute('x2', point.x * scale);

        $vline.setAttribute('y2', point.y * scale - point.color[1] * 7);
        $vlineBG.setAttribute('y2', point.y * scale - point.color[1] * 7);
        $vline.setAttribute('stroke', point.hslCSS);
        $vline.classList.add('wheel__satline');
        $vlineBG.setAttribute('stroke', '#fff');
        $vlineBG.classList.add('wheel__satline', 'wheel__satline--bg');
        $svg.appendChild($vlineBG);
        $svg.appendChild($vline);
        */
      });
      
      let cssColors = [...poline.colorsCSS];
      cssColors.pop();
      document.documentElement.style.setProperty(
        '--prev',
        colorArrToSteppedGradient(cssColors)
      )

    }

    updateSVG();

    let currentPoint = null;

    $picker.addEventListener('pointerdown', (e) => {
      const x = e.offsetX / $picker.offsetWidth;
      const y = e.offsetY / $picker.offsetHeight;

      currentPoint = poline.getClosestAnchorPoint([x, null, y], .1);
    });

    $picker.addEventListener('pointermove', (e) => {
      const x = e.offsetX / $picker.offsetWidth;
      const y = e.offsetY / $picker.offsetHeight;

      if (currentPoint) {
        currentPoint.x = x;
        currentPoint.y = y;
        currentPoint.positionOrColor = {
          x,
          y,
          z: currentPoint.z,
        };

        poline.updatePointPairs();
        updateSVG();
      }
    });



  $picker.addEventListener('pointerup', (e) => {
    currentPoint = null;
  });

  </script>
</body>

</html>